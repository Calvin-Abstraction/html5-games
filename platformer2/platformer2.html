<html>

<head>
</head>


<body>
    <p>based on: <a href=https://www.educative.io/edpresso/how-to-make-a-simple-platformer-using-javascript>This</a></p>
    <canvas id="canvas"></canvas>
    <script>
        // The attributes of the player.
        fps = 22
        var game = {
            frame: 0
        }
        var player = {
            x: 200,
            y: 200,
            x_v: 0,
            y_v: 0,
            jump: true,
            height: 20,
            width: 10,
            score: 0
        };
        // The status of the arrow keys
        var keys = {
            right: false,
            left: false,
            up: false,
        };
        platformHeight = 15;
        // The friction and gravity to show realistic movements
        var gravity = 0.6;
        var friction = 0.7;
        // The number of platforms
        var num = 5;
        // The platforms
        var platforms = [];
        // Function to render the canvas
        function rendercanvas() {
            ctx.fillStyle = "#F0F8FF";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        // Function to render the player
        function renderplayer() {
            ctx.fillStyle = "#F08080";
            ctx.fillRect((player.x) - player.width, (player.y) - player.height, player.width, player.height);
        }
        // Function to create platforms
        function createplat() {
            //push ground
            platforms.push({ x: 0, y: canvas.height - 15, width: canvas.width, height: 30, color: "brown" })
            platforms.push({ x: 50, y: canvas.height - 75, width: 110, height: platformHeight, color: "#45597E" })
            platforms.push({ x: canvas.width - 160, y: canvas.height - 75, width: 110, height: platformHeight, color: "#45597E" })
            platforms.push({ x: 200, y: canvas.height - 120, width: 100, height: platformHeight, color: "#45597E" })
            platforms.push({ x: canvas.width - 160, y: canvas.height - 180, width: 110, height: platformHeight, color: "#45597E" })
            platforms.push({ x: 200, y: canvas.height - 240, width: 100, height: platformHeight, color: "#45597E" })

        }
        // Function to render platforms
        function renderplat() {
            for (var j = 0; j < platforms.length; j++) {
                ctx.fillStyle = platforms[j].color;
                ctx.fillRect(platforms[j].x, platforms[j].y, platforms[j].width, platforms[j].height);
            }
        }
        // This function will be called when a key on the keyboard is pressed
        function keydown(e) {
            // 37 is the code for the left arrow key
            if (e.keyCode == 37 || e.keyCode == 65) {
                keys.left = true;
            }
            // 37 is the code for the up arrow key
            if (e.keyCode == 38 || e.keyCode == 87) {
                if (player.jump == false) {
                    player.y_v = -10;
                }
            }
            // 39 is the code for the right arrow key
            if (e.keyCode == 39 || e.keyCode == 68) {
                keys.right = true;
            }
        }
        // This function is called when the pressed key is released
        function keyup(e) {
            if (e.keyCode == 37 || e.keyCode == 65) {
                keys.left = false;
            }
            if (e.keyCode == 38 || e.keyCode == 87) {
                if (player.y_v < -2) {
                    player.y_v = -3;
                }
            }
            if (e.keyCode == 39 || e.keyCode == 68) {
                keys.right = false;
            }
        }
        function renderscore() {
            ctx.font = "30px Arial";
            player.score = Math.floor(game.frame / 5);
            ctx.fillText(player.score, 10, 50);
            if (game.frame > 0 && (game.frame % 4000 == 0)) {
                fps++
            }
            ctx.fillText(fps, canvas.width - 60, 50);
        }
        function loop() {
            // If the player is not jumping apply the effect of frictiom
            if (player.jump == false) {
                player.x_v *= friction;
            } else {
                // If the player is in the air then apply the effect of gravity
                player.y_v += gravity;
                //stop falling through platforms by setting terminal velocity
                if (player.y_v > platformHeight * 0.9) {
                    player.y_v = platformHeight * 0.9;
                }
            }
            player.jump = true;
            // If the left key is pressed increase the relevant horizontal velocity
            if (keys.left) {
                player.x_v = -2.5;
            }
            if (keys.right) {
                player.x_v = 2.5;
            }
            // Updating the y and x coordinates of the player
            player.y += player.y_v;
            player.x += player.x_v;
            // A simple code that checks for collions with the platform
            var i = -1;
            var plat = -1;
            //if motion is bound from below by a platform, set plat to that platform id
            for (i = 0; i < platforms.length; i++) { //check platform contact
                if (platforms[i].x < player.x && player.x < platforms[i].x + platforms[i].width + player.width &&
                    platforms[i].y < player.y && player.y < platforms[i].y + platforms[i].height) {
                    plat = i;
                }
            }
            if (plat > -1) {
                player.jump = false;
                player.y = platforms[plat].y;
            }
            //Fix box to left or right of screen
            if (player.x - player.width < 0) {
                player.x = player.width;
            } else if (player.x > canvas.width) {
                player.x = canvas.width
            }

            // Rendering the canvas, the player and the platforms
            rendercanvas();
            renderplayer();
            renderplat();
            renderscore();
            game.frame++;
        }
        canvas = document.getElementById("canvas");
        ctx = canvas.getContext("2d");
        ctx.canvas.height = 500;
        ctx.canvas.width = 500;
        createplat();
        // Adding the event listeners
        document.addEventListener("keydown", keydown);
        document.addEventListener("keyup", keyup);
        setInterval(loop, fps);
    </script>
    <p>Use arrow keys or WASD to move</p>
</body>

</html>